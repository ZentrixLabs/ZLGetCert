<Window x:Class="ZLGetCert.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:enums="clr-namespace:ZLGetCert.Enums"
        xmlns:local="clr-namespace:ZLGetCert.Converters"
        mc:Ignorable="d"
        Title="ZLGetCert - Certificate Management" 
        Height="800" 
        Width="1000"
        MinHeight="600"
        MinWidth="800"
        WindowStartupLocation="CenterScreen"
        Icon="pack://application:,,,/ZLGetCert_icon_v2.ico">
    
    <Window.Resources>
        <!-- Converters -->
        <local:EnumToBoolConverter x:Key="EnumToBoolConverter"/>
        <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <local:InverseBoolConverter x:Key="InverseBoolConverter"/>
        <local:EmptyStringToVisibilityConverter x:Key="EmptyStringToVisibilityConverter"/>
        <local:InverseEmptyStringToVisibilityConverter x:Key="InverseEmptyStringToVisibilityConverter"/>
        <local:EmptyStringToBoolConverter x:Key="EmptyStringToBoolConverter"/>
        
        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>
        
        <Style x:Key="SectionTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,15,0,5"/>
        </Style>
        
        <Style x:Key="StatusTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="Gray"/>
            <Setter Property="Margin" Value="0,5,0,0"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="0,0,0,1">
            <MenuItem Header="_File">
                <MenuItem Header="_New Certificate" 
                          Command="{Binding ClearFormCommand}"
                          ToolTip="Clear the form and start a new certificate request (Ctrl+N)"
                          InputGestureText="Ctrl+N"/>
                <Separator/>
                <MenuItem Header="E_xit" 
                          Click="Exit_Click"
                          ToolTip="Exit the application (Alt+F4)"
                          InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Settings" 
                          Command="{Binding ShowSettingsCommand}"
                          ToolTip="Open application settings panel (Ctrl+,)"
                          InputGestureText="Ctrl+,"/>
                <MenuItem Header="_Configuration Editor..." 
                          Command="{Binding OpenConfigurationEditorCommand}"
                          ToolTip="Edit appsettings.json directly with JSON validation"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_Users Guide" 
                          Command="{Binding OpenUsersGuideCommand}"
                          ToolTip="Open comprehensive users guide (F1)"
                          InputGestureText="F1"/>
                <MenuItem Header="_About" 
                          Click="About_Click"
                          ToolTip="About ZLGetCert - Version and credits"/>
            </MenuItem>
        </Menu>

        <!-- Header -->
        <Border Grid.Row="1" Background="#2E3440" Padding="20,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0">
                    <TextBlock Text="ZLGetCert" Style="{StaticResource HeaderTextStyle}" Foreground="White"/>
                    <TextBlock Text="Certificate Management for On-Premises CA" 
                               Style="{StaticResource StatusTextStyle}" Foreground="#D8DEE9"/>
                </StackPanel>
                
                <!-- Quick Actions -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- Settings moved to Edit menu - no header button needed -->
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="2">
            <!-- Certificate Request Form -->
            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                <StackPanel>
                    <Grid>
                        <TextBlock Text="Certificate Request" 
                                   Style="{StaticResource HeaderTextStyle}"
                                   HorizontalAlignment="Left"/>
                        <TextBlock HorizontalAlignment="Right" 
                                   VerticalAlignment="Center"
                                   Margin="0,0,0,10">
                            <Hyperlink Command="{Binding OpenUsersGuideCommand}" 
                                       TextDecorations="None">
                                <Run Text="❓ Click Here for Help" 
                                     FontSize="14" 
                                     Foreground="#007ACC"/>
                            </Hyperlink>
                        </TextBlock>
                    </Grid>
                    
                    <!-- Action Buttons Card - CSR Import at Top for Quick Access -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Choose Your Workflow" Style="{StaticResource SectionHeaderStyle}"/>
                            
                            <!-- Option 1: Import Existing CSR (Quick Path) -->
                            <StackPanel>
                                <Button Content="📄 Import &amp; Sign CSR File..." 
                                        Command="{Binding CertificateRequest.ImportFromCSRCommand}"
                                        Style="{StaticResource PrimaryButtonStyle}"
                                        ToolTip="Submit an existing Certificate Signing Request file to the CA (Alt+I)"
                                        FontSize="14"
                                        Padding="20,10"
                                        FontWeight="SemiBold"
                                        HorizontalAlignment="Stretch"
                                        Margin="0,0,0,5"/>
                                <TextBlock Text="Already have a .csr file? Click here to skip the form below" 
                                           FontSize="11"
                                           Foreground="#666666"
                                           Margin="5,0,0,0"/>
                            </StackPanel>
                            
                            <!-- Separator with OR -->
                            <Border BorderBrush="#E0E0E0" 
                                    BorderThickness="0,1,0,0" 
                                    Margin="0,15,0,15">
                                <TextBlock Text="OR" 
                                           HorizontalAlignment="Center"
                                           FontSize="11"
                                           FontWeight="SemiBold"
                                           Foreground="#999999"
                                           Background="White"
                                           Padding="10,0"
                                           Margin="0,-10,0,0"/>
                            </Border>
                            
                            <!-- Option 2: Generate New Certificate (Form Required) -->
                            <StackPanel>
                                <TextBlock Text="Create a new certificate from scratch:" 
                                           FontSize="12"
                                           Foreground="#333333"
                                           FontWeight="SemiBold"
                                           Margin="0,0,0,8"/>
                                <TextBlock Text="1. Fill out the form below with certificate details" 
                                           FontSize="11"
                                           Foreground="#666666"
                                           Margin="5,0,0,3"/>
                                <TextBlock Text="2. Click the Generate button at the bottom when ready" 
                                           FontSize="11"
                                           Foreground="#666666"
                                           Margin="5,0,0,0"/>
                            </StackPanel>
                            
                            <!-- Additional Actions -->
                            <Border BorderBrush="#E0E0E0" 
                                    BorderThickness="0,1,0,0" 
                                    Margin="0,15,0,10"/>
                            
                            <Button Content="💾 Save as Defaults" 
                                    Command="{Binding SaveAsDefaultsCommand}"
                                    Style="{StaticResource SecondaryButtonStyle}"
                                    ToolTip="Save current CA server, template, and organization settings as defaults (Alt+D)"
                                    HorizontalAlignment="Left"
                                    Padding="12,6"
                                    FontSize="12"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Certificate Authority Configuration Card -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Certificate Authority" Style="{StaticResource SectionHeaderStyle}"/>
                            
                            <StackPanel Style="{StaticResource FormGroupStyle}">
                                <TextBlock Text="CA Server *" Style="{StaticResource FieldLabelStyle}"/>
                                <ComboBox ItemsSource="{Binding CertificateRequest.AvailableCAs}" 
                                          Text="{Binding CertificateRequest.CAServer}"
                                          IsEditable="True"
                                          ToolTip="Required: Select your organization's Certificate Authority server from Active Directory or type a custom CA server name. Example: ca.company.com">
                                    <ComboBox.Style>
                                        <Style TargetType="ComboBox">
                                            <Setter Property="Foreground" Value="Black"/>
                                            <Setter Property="BorderBrush" Value="#CED4DA"/>
                                            <Setter Property="BorderThickness" Value="1"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CertificateRequest.CAServerError, Converter={StaticResource EmptyStringToBoolConverter}}" Value="False">
                                                    <Setter Property="BorderBrush" Value="#DC3545"/>
                                                    <Setter Property="BorderThickness" Value="2"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ComboBox.Style>
                                </ComboBox>
                                <TextBlock Text="{Binding CertificateRequest.CAServerError}" 
                                           FontSize="11"
                                           Foreground="#DC3545"
                                           FontWeight="SemiBold"
                                           Margin="0,3,0,0"
                                           Visibility="{Binding CertificateRequest.CAServerError, Converter={StaticResource EmptyStringToVisibilityConverter}}"/>
                                <TextBlock Text="Select from Active Directory CAs or type a custom server name" 
                                           Style="{StaticResource StatusTextStyle}"
                                           Margin="0,2,0,0"
                                           Visibility="{Binding CertificateRequest.CAServerError, Converter={StaticResource InverseEmptyStringToVisibilityConverter}}"/>
                            </StackPanel>
                            
                            <StackPanel Style="{StaticResource FormGroupStyle}">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                    <TextBlock Text="Certificate Template *" Style="{StaticResource FieldLabelStyle}" Margin="0"/>
                                    <Border Background="#E8F4FD" 
                                            BorderBrush="#007ACC" 
                                            BorderThickness="1" 
                                            CornerRadius="3"
                                            Margin="8,0,0,0"
                                            Cursor="Hand"
                                            ToolTip="Click for template selection help">
                                        <Button Command="{Binding ShowTemplateHelpCommand}"
                                                Style="{StaticResource SecondaryButtonStyle}"
                                                Width="24"
                                                Height="20"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                Padding="0">
                                            <TextBlock Text="?" 
                                                       FontSize="12" 
                                                       FontWeight="Bold"
                                                       Foreground="#007ACC"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"/>
                                        </Button>
                                    </Border>
                                </StackPanel>
                                
                                <ComboBox ItemsSource="{Binding CertificateRequest.AvailableTemplates}" 
                                          SelectedValue="{Binding CertificateRequest.Template}"
                                          SelectedValuePath="Name"
                                          IsEditable="True">
                                    <ComboBox.Style>
                                        <Style TargetType="ComboBox">
                                            <Setter Property="Foreground" Value="Black"/>
                                            <Setter Property="BorderBrush" Value="#CED4DA"/>
                                            <Setter Property="BorderThickness" Value="1"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CertificateRequest.TemplateError, Converter={StaticResource EmptyStringToBoolConverter}}" Value="False">
                                                    <Setter Property="BorderBrush" Value="#DC3545"/>
                                                    <Setter Property="BorderThickness" Value="2"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ComboBox.Style>
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Margin="0,4">
                                                <TextBlock Text="{Binding DisplayText}" 
                                                           FontWeight="SemiBold"
                                                           FontSize="12"/>
                                                <TextBlock Text="{Binding Description}" 
                                                           FontSize="10" 
                                                           Foreground="#666666"
                                                           TextWrapping="Wrap"
                                                           Margin="0,2,0,0"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                                <TextBlock Text="{Binding CertificateRequest.TemplateError}" 
                                           FontSize="11"
                                           Foreground="#DC3545"
                                           FontWeight="SemiBold"
                                           Margin="0,3,0,0"
                                           Visibility="{Binding CertificateRequest.TemplateError, Converter={StaticResource EmptyStringToVisibilityConverter}}"/>
                                <TextBlock Text="Select from the list or type a custom template name" 
                                           Style="{StaticResource StatusTextStyle}"
                                           Margin="0,2,0,0"
                                           Visibility="{Binding CertificateRequest.TemplateError, Converter={StaticResource InverseEmptyStringToVisibilityConverter}}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Wildcard Option Card (Only for Web Server templates) -->
                    <Border Style="{StaticResource CardStyle}"
                            Visibility="{Binding CertificateRequest.ShowWildcardOption, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel>
                            <TextBlock Text="Certificate Options" Style="{StaticResource SectionHeaderStyle}"/>
                            <CheckBox Content="Wildcard Certificate (*.domain.com)"
                                      IsChecked="{Binding CertificateRequest.IsWildcard}"
                                      ToolTip="Generate a wildcard certificate valid for all subdomains. Example: *.company.com secures www.company.com, api.company.com, mail.company.com, etc."
                                      Margin="0,5,0,10"/>
                            <TextBlock Text="A wildcard certificate can secure *.company.com (all subdomains)" 
                                       Style="{StaticResource StatusTextStyle}"
                                       TextWrapping="Wrap"/>
                        </StackPanel>
                    </Border>

                    <!-- CSR Import Option (shown when CSR file is selected) -->
                    <Border Style="{StaticResource CardStyle}" 
                            Visibility="{Binding CertificateRequest.IsCSRWorkflow, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel>
                            <TextBlock Text="CSR File Import" Style="{StaticResource SectionHeaderStyle}"/>
                            <TextBlock Text="✅ CSR file loaded - hostname, organization info, and SANs from CSR" 
                                       Foreground="Green"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,10"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" 
                                         Text="{Binding CertificateRequest.CsrFilePath}" 
                                         IsReadOnly="True"
                                         Margin="0,0,10,0"/>
                                <Button Grid.Column="1" 
                                        Content="❌ Clear" 
                                        Click="ClearCSR_Click"
                                        Style="{StaticResource SecondaryButtonStyle}"/>
                            </Grid>
                            <TextBlock Text="ℹ️ The CSR file already contains subject DN and SANs. You only need to select the CA server, template, and password." 
                                       Style="{StaticResource StatusTextStyle}"
                                       TextWrapping="Wrap"
                                       Margin="0,10,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Hostname and FQDN Card (Only for Web Server templates) -->
                    <Border Style="{StaticResource CardStyle}" 
                            Visibility="{Binding CertificateRequest.ShowHostnameFields, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel>
                            <TextBlock Text="Domain Information" Style="{StaticResource SectionHeaderStyle}"/>
                            
                            <StackPanel Style="{StaticResource FormGroupStyle}">
                                <TextBlock Text="Hostname *" Style="{StaticResource FieldLabelStyle}"/>
                                <TextBox Text="{Binding CertificateRequest.HostName}" 
                                         IsEnabled="{Binding CertificateRequest.IsWildcard, Converter={StaticResource InverseBoolConverter}}"
                                         ToolTip="Required for standard certificates: Server hostname without domain. Examples: www, api, mail, vpn">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox">
                                            <Setter Property="BorderBrush" Value="#CED4DA"/>
                                            <Setter Property="BorderThickness" Value="1"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CertificateRequest.HostNameError, Converter={StaticResource EmptyStringToBoolConverter}}" Value="False">
                                                    <Setter Property="BorderBrush" Value="#DC3545"/>
                                                    <Setter Property="BorderThickness" Value="2"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>
                                <TextBlock Text="{Binding CertificateRequest.HostNameError}" 
                                           FontSize="11"
                                           Foreground="#DC3545"
                                           FontWeight="SemiBold"
                                           Margin="0,3,0,0"
                                           Visibility="{Binding CertificateRequest.HostNameError, Converter={StaticResource EmptyStringToVisibilityConverter}}"/>
                                <TextBlock Text="Not needed for wildcard certificates" 
                                           Visibility="{Binding CertificateRequest.IsWildcard, Converter={StaticResource BoolToVisibilityConverter}}"
                                           Style="{StaticResource StatusTextStyle}"
                                           Margin="0,2,0,0"/>
                            </StackPanel>
                            
                            <StackPanel Style="{StaticResource FormGroupStyle}">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                    <TextBlock Text="Fully Qualified Domain Name (FQDN)" 
                                               Style="{StaticResource FieldLabelStyle}" 
                                               Margin="0"/>
                                    <TextBlock Text="{Binding CertificateRequest.FqdnDisplayText}"
                                               FontSize="11"
                                               Foreground="#666666"
                                               Margin="8,0,0,0"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBox Grid.Column="0"
                                             Text="{Binding CertificateRequest.FQDN, UpdateSourceTrigger=PropertyChanged}" 
                                             IsReadOnly="{Binding CertificateRequest.IsFqdnReadOnly}"
                                             ToolTip="{Binding CertificateRequest.FqdnTooltip}"
                                             Margin="0,0,10,0">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Setter Property="Background" Value="#F5F5F5"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding CertificateRequest.IsFqdnManuallyEdited}" Value="True">
                                                        <Setter Property="Background" Value="White"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                    
                                    <Button Grid.Column="1"
                                            Content="{Binding CertificateRequest.FqdnEditButtonText}"
                                            Command="{Binding CertificateRequest.ToggleFqdnEditModeCommand}"
                                            Style="{StaticResource SecondaryButtonStyle}"
                                            Width="60"
                                            ToolTip="Toggle between auto-generated and manual FQDN entry"/>
                                </Grid>
                                
                                <TextBlock FontSize="10" 
                                           Foreground="#666666"
                                           Margin="0,3,0,0"
                                           TextWrapping="Wrap">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="Auto-generated from hostname + organization. Click 'Edit' to manually override."/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CertificateRequest.IsFqdnManuallyEdited}" Value="True">
                                                    <Setter Property="Text" Value="Manual mode: Click 'Auto' to restore automatic generation."/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Organization Information Card (Not needed for CSR import - already in CSR) -->
                    <Border Style="{StaticResource CardStyle}"
                            Visibility="{Binding CertificateRequest.IsCSRWorkflow, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                        <StackPanel>
                            <TextBlock Text="Organization Information" Style="{StaticResource SectionHeaderStyle}"/>
                            <TextBlock Text="These fields become part of the certificate's X.500 Distinguished Name (DN)"
                                       FontSize="11"
                                       Foreground="#666666"
                                       Margin="0,0,0,10"
                                       TextWrapping="Wrap"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Style="{StaticResource FormGroupStyle}">
                                    <TextBlock Text="Location (City) *" Style="{StaticResource FieldLabelStyle}"/>
                                    <TextBox Text="{Binding CertificateRequest.Location}"
                                             ToolTip="Required: City name for certificate subject. Examples: Seattle, New York, London">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Setter Property="BorderBrush" Value="#CED4DA"/>
                                                <Setter Property="BorderThickness" Value="1"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding CertificateRequest.LocationError, Converter={StaticResource EmptyStringToBoolConverter}}" Value="False">
                                                        <Setter Property="BorderBrush" Value="#DC3545"/>
                                                        <Setter Property="BorderThickness" Value="2"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                    <TextBlock Text="{Binding CertificateRequest.LocationError}" 
                                               FontSize="11"
                                               Foreground="#DC3545"
                                               FontWeight="SemiBold"
                                               Margin="0,3,0,0"
                                               Visibility="{Binding CertificateRequest.LocationError, Converter={StaticResource EmptyStringToVisibilityConverter}}"/>
                                    <TextBlock FontSize="10"
                                               Foreground="#666666"
                                               Margin="0,3,0,0"
                                               Visibility="{Binding CertificateRequest.LocationError, Converter={StaticResource InverseEmptyStringToVisibilityConverter}}">
                                        <Run Text="X.500 field: L (Locality)" FontWeight="SemiBold"/><LineBreak/>
                                        <Run Text="Examples: Seattle, New York, London"/>
                                    </TextBlock>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2" Style="{StaticResource FormGroupStyle}">
                                    <TextBlock Text="State *" Style="{StaticResource FieldLabelStyle}"/>
                                    <TextBox Text="{Binding CertificateRequest.State}" 
                                             MaxLength="2"
                                             ToolTip="Required: Two-letter state/province code. Examples: WA, CA, NY, TX">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Setter Property="BorderBrush" Value="#CED4DA"/>
                                                <Setter Property="BorderThickness" Value="1"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding CertificateRequest.StateError, Converter={StaticResource EmptyStringToBoolConverter}}" Value="False">
                                                        <Setter Property="BorderBrush" Value="#DC3545"/>
                                                        <Setter Property="BorderThickness" Value="2"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                    <TextBlock Text="{Binding CertificateRequest.StateError}" 
                                               FontSize="11"
                                               Foreground="#DC3545"
                                               FontWeight="SemiBold"
                                               Margin="0,3,0,0"
                                               Visibility="{Binding CertificateRequest.StateError, Converter={StaticResource EmptyStringToVisibilityConverter}}"/>
                                    <TextBlock FontSize="10"
                                               Foreground="#666666"
                                               Margin="0,3,0,0"
                                               Visibility="{Binding CertificateRequest.StateError, Converter={StaticResource InverseEmptyStringToVisibilityConverter}}">
                                        <Run Text="X.500 field: S (State)" FontWeight="SemiBold"/><LineBreak/>
                                        <Run Text="Examples: WA, CA, NY, TX"/>
                                    </TextBlock>
                                </StackPanel>
                            </Grid>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Style="{StaticResource FormGroupStyle}">
                                    <TextBlock Text="Organization *" Style="{StaticResource FieldLabelStyle}"/>
                                    <TextBox Text="{Binding CertificateRequest.Company}"
                                             ToolTip="Required: Your organization's domain name. Examples: company.com, organization.org"/>
                                    <TextBlock FontSize="10"
                                               Foreground="#666666"
                                               Margin="0,3,0,0">
                                        <Run Text="X.500 field: O (Organization)" FontWeight="SemiBold"/><LineBreak/>
                                        <Run Text="Examples: company.com, acme.org"/>
                                    </TextBlock>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2" Style="{StaticResource FormGroupStyle}">
                                    <TextBlock Text="Organizational Unit *" Style="{StaticResource FieldLabelStyle}"/>
                                    <TextBox Text="{Binding CertificateRequest.OU}"
                                             ToolTip="Required: Department or division name. Examples: IT, Engineering, Operations"/>
                                    <TextBlock FontSize="10"
                                               Foreground="#666666"
                                               Margin="0,3,0,0">
                                        <Run Text="X.500 field: OU (Organizational Unit)" FontWeight="SemiBold"/><LineBreak/>
                                        <Run Text="Examples: IT, Engineering, Operations"/>
                                    </TextBlock>
                                </StackPanel>
                            </Grid>
                            
                            <!-- Certificate Subject Preview -->
                            <Border Background="#F0F8FF" 
                                    BorderBrush="#007ACC" 
                                    BorderThickness="1" 
                                    CornerRadius="4"
                                    Padding="12"
                                    Margin="0,15,0,0">
                                <StackPanel>
                                    <TextBlock Text="📋 Certificate Subject Preview" 
                                               FontWeight="SemiBold" 
                                               FontSize="12"
                                               Foreground="#333333"
                                               Margin="0,0,0,5"/>
                                    <TextBlock Text="{Binding CertificateRequest.CertificateSubjectPreview}"
                                               FontSize="11"
                                               FontFamily="Consolas, Courier New"
                                               Foreground="#007ACC"
                                               TextWrapping="Wrap"/>
                                    <TextBlock Text="This Distinguished Name (DN) will identify your certificate"
                                               FontSize="10"
                                               Foreground="#666666"
                                               Margin="0,5,0,0"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Border>

                    <!-- SANs Card (Only for Web Server templates) -->
                    <Border Style="{StaticResource CardStyle}" 
                            Visibility="{Binding CertificateRequest.ShowHostnameFields, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel>
                            <TextBlock Text="Subject Alternative Names (SANs)" Style="{StaticResource SectionHeaderStyle}"/>
                            
                            <!-- DNS SANs -->
                            <StackPanel Style="{StaticResource FormGroupStyle}">
                                <TextBlock Text="DNS Names" Style="{StaticResource FieldLabelStyle}"/>
                                <ItemsControl ItemsSource="{Binding CertificateRequest.DnsSans}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="0,2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBox Grid.Column="0" 
                                                         Text="{Binding Value}" 
                                                         Margin="0,0,10,0"/>
                                                <Button Grid.Column="1" 
                                                        Content="❌" 
                                                        Command="{Binding DataContext.RemoveDnsSanCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}"
                                                        Style="{StaticResource IconButtonStyle}"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <Button Content="➕ Add DNS Name" 
                                        Command="{Binding AddDnsSanCommand}"
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        Margin="0,5,0,0"/>
                            </StackPanel>

                            <!-- IP SANs -->
                            <StackPanel Style="{StaticResource FormGroupStyle}">
                                <TextBlock Text="IP Addresses" Style="{StaticResource FieldLabelStyle}"/>
                                <ItemsControl ItemsSource="{Binding CertificateRequest.IpSans}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="0,2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBox Grid.Column="0" 
                                                         Text="{Binding Value}" 
                                                         Margin="0,0,10,0"/>
                                                <Button Grid.Column="1" 
                                                        Content="❌" 
                                                        Command="{Binding DataContext.RemoveIpSanCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}"
                                                        Style="{StaticResource IconButtonStyle}"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <Button Content="➕ Add IP Address" 
                                        Command="{Binding AddIpSanCommand}"
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        Margin="0,5,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Security Settings Card -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Security Settings" Style="{StaticResource SectionHeaderStyle}"/>
                            
                            <!-- PFX Password -->
                            <StackPanel Style="{StaticResource FormGroupStyle}">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                    <TextBlock Text="PFX Password *" Style="{StaticResource FieldLabelStyle}" Margin="0"/>
                                    <TextBlock Text="ⓘ" 
                                               FontSize="14" 
                                               Foreground="#007ACC" 
                                               Margin="5,0,0,0"
                                               ToolTip="This password protects the exported PFX certificate file. You'll need this password to import the certificate on other systems."
                                               Cursor="Help"/>
                                </StackPanel>
                                
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Password Box (hidden when showing password) -->
                                    <PasswordBox Grid.Column="0" 
                                                 x:Name="PfxPasswordBox"
                                                 util:PasswordBoxHelper.Attach="True"
                                                 util:PasswordBoxHelper.SecurePassword="{Binding CertificateRequest.PfxPassword, Mode=TwoWay}"
                                                 Margin="0,0,5,0"
                                                 Padding="8"
                                                 FontSize="12"
                                                 Visibility="{Binding CertificateRequest.ShowPassword, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                                 xmlns:util="clr-namespace:ZLGetCert.Utilities"/>
                                    
                                    <!-- TextBox (shown when revealing password) -->
                                    <TextBox Grid.Column="0"
                                             x:Name="PfxPasswordTextBox"
                                             Text="{Binding CertificateRequest.PfxPassword, Converter={StaticResource SecureStringToStringConverter}, Mode=TwoWay}"
                                             Margin="0,0,5,0"
                                             Padding="8"
                                             FontSize="12"
                                             Visibility="{Binding CertificateRequest.ShowPassword, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    
                                    <Button Grid.Column="1" 
                                            Content="👁" 
                                            Command="{Binding CertificateRequest.TogglePasswordVisibilityCommand}"
                                            Style="{StaticResource IconButtonStyle}"
                                            Width="32"
                                            Height="32"
                                            Margin="0,0,5,0"
                                            ToolTip="Toggle password visibility"/>
                                    
                                    <Button Grid.Column="2" 
                                            Content="📋" 
                                            Command="{Binding CertificateRequest.CopyPasswordCommand}"
                                            Style="{StaticResource IconButtonStyle}"
                                            Width="32"
                                            Height="32"
                                            Margin="0,0,5,0"
                                            ToolTip="Copy password to clipboard"/>
                                    
                                    <Button Grid.Column="3" 
                                            Content="🔑" 
                                            Command="{Binding CertificateRequest.GeneratePasswordCommand}"
                                            Style="{StaticResource SecondaryButtonStyle}"
                                            Padding="8,4"
                                            ToolTip="Generate strong password"/>
                                </Grid>
                                
                                <!-- Password Strength Meter -->
                                <Grid Margin="0,8,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Strength Bar Background -->
                                    <Border Grid.Column="0" 
                                            Background="#E0E0E0" 
                                            Height="8" 
                                            CornerRadius="4"
                                            Margin="0,0,10,0">
                                        <!-- Strength Bar Fill -->
                                        <Border Background="{Binding CertificateRequest.PasswordStrengthValue, Converter={StaticResource PasswordStrengthToColorConverter}}"
                                                Height="8"
                                                CornerRadius="4"
                                                HorizontalAlignment="Left">
                                            <Border.Width>
                                                <MultiBinding Converter="{StaticResource PercentageWidthConverter}">
                                                    <Binding Path="ActualWidth" RelativeSource="{RelativeSource AncestorType=Border}"/>
                                                    <Binding Path="CertificateRequest.PasswordStrengthValue" Converter="{StaticResource PasswordStrengthToValueConverter}"/>
                                                </MultiBinding>
                                            </Border.Width>
                                        </Border>
                                    </Border>
                                    
                                    <!-- Strength Text -->
                                    <TextBlock Grid.Column="1" 
                                               Text="{Binding CertificateRequest.PasswordStrengthValue, Converter={StaticResource PasswordStrengthToTextConverter}}"
                                               Foreground="{Binding CertificateRequest.PasswordStrengthValue, Converter={StaticResource PasswordStrengthToColorConverter}}"
                                               FontWeight="SemiBold"
                                               VerticalAlignment="Center"
                                               FontSize="11"/>
                                </Grid>
                                
                                <!-- Password Requirements -->
                                <TextBlock Text="{Binding CertificateRequest.PasswordRequirements}" 
                                           FontSize="10"
                                           Foreground="#666666"
                                           Margin="0,5,0,0"/>
                                
                                <!-- Password Validation Status -->
                                <TextBlock Text="{Binding CertificateRequest.PasswordValidation}" 
                                           FontSize="10"
                                           Margin="0,3,0,0">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#DC3545"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CertificateRequest.PasswordValidation}" Value="✓ All requirements met">
                                                    <Setter Property="Foreground" Value="#28A745"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>

                            <!-- Confirm Password -->
                            <StackPanel Style="{StaticResource FormGroupStyle}">
                                <TextBlock Text="Confirm Password *" Style="{StaticResource FieldLabelStyle}"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Password Box (hidden when showing password) -->
                                    <PasswordBox Grid.Column="0" 
                                                 x:Name="ConfirmPasswordBox"
                                                 util:PasswordBoxHelper.Attach="True"
                                                 util:PasswordBoxHelper.SecurePassword="{Binding CertificateRequest.ConfirmPassword, Mode=TwoWay}"
                                                 Margin="0,0,10,0"
                                                 Padding="8"
                                                 FontSize="12"
                                                 Visibility="{Binding CertificateRequest.ShowConfirmPassword, Converter={StaticResource InverseBoolToVisibilityConverter}}"
                                                 xmlns:util="clr-namespace:ZLGetCert.Utilities">
                                        <PasswordBox.Style>
                                            <Style TargetType="PasswordBox">
                                                <Setter Property="BorderBrush" Value="#CED4DA"/>
                                                <Setter Property="BorderThickness" Value="1"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding CertificateRequest.ConfirmPasswordError, Converter={StaticResource EmptyStringToBoolConverter}}" Value="False">
                                                        <Setter Property="BorderBrush" Value="#DC3545"/>
                                                        <Setter Property="BorderThickness" Value="2"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </PasswordBox.Style>
                                    </PasswordBox>
                                    
                                    <!-- TextBox (shown when revealing password) -->
                                    <TextBox Grid.Column="0"
                                             x:Name="ConfirmPasswordTextBox"
                                             Text="{Binding CertificateRequest.ConfirmPassword, Converter={StaticResource SecureStringToStringConverter}, Mode=TwoWay}"
                                             Margin="0,0,10,0"
                                             Padding="8"
                                             FontSize="12"
                                             Visibility="{Binding CertificateRequest.ShowConfirmPassword, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <TextBox.Style>
                                            <Style TargetType="TextBox">
                                                <Setter Property="BorderBrush" Value="#CED4DA"/>
                                                <Setter Property="BorderThickness" Value="1"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding CertificateRequest.ConfirmPasswordError, Converter={StaticResource EmptyStringToBoolConverter}}" Value="False">
                                                        <Setter Property="BorderBrush" Value="#DC3545"/>
                                                        <Setter Property="BorderThickness" Value="2"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBox.Style>
                                    </TextBox>
                                    
                                    <Button Grid.Column="1" 
                                            Content="👁" 
                                            Command="{Binding CertificateRequest.ToggleConfirmPasswordVisibilityCommand}"
                                            Style="{StaticResource IconButtonStyle}"
                                            Width="32"
                                            Height="32"
                                            ToolTip="Toggle password visibility"/>
                                </Grid>
                                <TextBlock Text="{Binding CertificateRequest.ConfirmPasswordError}" 
                                           FontSize="11"
                                           Foreground="#DC3545"
                                           FontWeight="SemiBold"
                                           Margin="0,3,0,0"
                                           Visibility="{Binding CertificateRequest.ConfirmPasswordError, Converter={StaticResource EmptyStringToVisibilityConverter}}"/>
                            </StackPanel>

                            <!-- PEM/KEY Export Options -->
                            <StackPanel Style="{StaticResource FormGroupStyle}">
                                <CheckBox Content="Extract PEM and KEY files" 
                                          IsChecked="{Binding CertificateRequest.ExtractPemKey}"
                                          ToolTip="Export certificate and private key in PEM format. Required for Apache, NGINX, HAProxy and other web servers. Built-in .NET export - no OpenSSL needed."/>
                                
                                <!-- Collapsible Security Warning for Unencrypted Keys -->
                                <StackPanel Visibility="{Binding CertificateRequest.ShowKeySecurityWarning, Converter={StaticResource BoolToVisibilityConverter}}"
                                           Margin="0,8,0,0">
                                    <!-- Compact Warning Header (Always Visible) -->
                                    <Button Command="{Binding CertificateRequest.ToggleSecurityWarningCommand}"
                                            Style="{StaticResource SecondaryButtonStyle}"
                                            HorizontalAlignment="Left"
                                            HorizontalContentAlignment="Left"
                                            Padding="8,6"
                                            Background="#FFF3CD"
                                            BorderBrush="#FFC107"
                                            Margin="0,0,0,5">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="⚠️" FontSize="12" Margin="0,0,5,0"/>
                                            <TextBlock Text="Unencrypted key file - Click for security info" 
                                                       FontSize="11" 
                                                       Foreground="#856404"
                                                       FontWeight="SemiBold"
                                                       Margin="0,0,8,0"/>
                                            <TextBlock Text="{Binding CertificateRequest.SecurityWarningIndicator}" 
                                                       FontSize="11" 
                                                       Foreground="#856404"
                                                       FontWeight="Bold"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <!-- Expanded Warning Details (Collapsible) -->
                                    <Border Background="#FFF3CD" 
                                            BorderBrush="#FFC107" 
                                            BorderThickness="1" 
                                            Padding="12"
                                            Visibility="{Binding CertificateRequest.SecurityWarningExpanded, Converter={StaticResource BoolToVisibilityConverter}}">
                                        <StackPanel>
                                            <TextBlock Text="SECURITY NOTICE" 
                                                       FontWeight="Bold" 
                                                       Foreground="#856404"
                                                       FontSize="11"
                                                       Margin="0,0,0,8"/>
                                            <TextBlock TextWrapping="Wrap" Foreground="#856404" FontSize="10" Margin="0,0,0,8">
                                                <Run Text="The .key file will be UNENCRYPTED (required by web servers)."/>
                                            </TextBlock>
                                            
                                            <TextBlock Text="Security protections applied:" 
                                                       FontWeight="SemiBold" 
                                                       Foreground="#856404" 
                                                       FontSize="10"
                                                       Margin="0,0,0,3"/>
                                            <TextBlock TextWrapping="Wrap" Foreground="#856404" FontSize="10" Margin="0,0,0,8">
                                                <Run Text="✓ File permissions set to owner-only automatically"/>
                                                <LineBreak/>
                                                <Run Text="✓ All exports logged to audit trail"/>
                                            </TextBlock>
                                            
                                            <TextBlock Text="Your responsibilities:" 
                                                       FontWeight="SemiBold" 
                                                       Foreground="#856404" 
                                                       FontSize="10"
                                                       Margin="0,0,0,3"/>
                                            <TextBlock TextWrapping="Wrap" Foreground="#856404" FontSize="10">
                                                <Run Text="• Copy to server using encrypted transfer (SFTP/SCP)"/>
                                                <LineBreak/>
                                                <Run Text="• Verify file permissions on destination (chmod 600)"/>
                                                <LineBreak/>
                                                <Run Text="• Securely delete local copy after deployment"/>
                                                <LineBreak/>
                                                <Run Text="• NEVER store in cloud storage or version control"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                                
                                <CheckBox Content="Extract CA bundle (intermediate + root certificates)" 
                                          IsChecked="{Binding CertificateRequest.ExtractCaBundle}"
                                          IsEnabled="{Binding CertificateRequest.ExtractPemKey}"
                                          Margin="0,5,0,0"
                                          ToolTip="Export the certificate chain (intermediate and root CA certificates) for full server validation. Recommended for web servers."/>
                                <TextBlock Text="{Binding OpenSSLStatus}" 
                                           Style="{StaticResource StatusTextStyle}"
                                           Margin="0,5,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Validation Summary Panel -->
                    <Border Margin="0,10,0,10">
                        <Border.Style>
                            <Style TargetType="Border" BasedOn="{StaticResource CardStyle}">
                                <Setter Property="Background" Value="#D4EDDA"/>
                                <Setter Property="BorderBrush" Value="#28A745"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CertificateRequest.HasValidationErrors}" Value="True">
                                        <Setter Property="Background" Value="#F8D7DA"/>
                                        <Setter Property="BorderBrush" Value="#DC3545"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                        <StackPanel>
                            <!-- Header -->
                            <TextBlock FontSize="14" FontWeight="SemiBold" Margin="0,0,0,8">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="✓ Ready to Generate"/>
                                        <Setter Property="Foreground" Value="#28A745"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding CertificateRequest.HasValidationErrors}" Value="True">
                                                <Setter Property="Text" Value="⚠ Cannot Generate Certificate"/>
                                                <Setter Property="Foreground" Value="#DC3545"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            
                            <!-- Validation Summary Message -->
                            <TextBlock Text="{Binding CertificateRequest.ValidationSummary}" 
                                       FontSize="12" 
                                       TextWrapping="Wrap">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="#155724"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding CertificateRequest.HasValidationErrors}" Value="True">
                                                <Setter Property="Foreground" Value="#721C24"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </Border>
                    
                    <!-- Generate Certificate Button - Bottom of Form -->
                    <Border Style="{StaticResource CardStyle}" Background="#F8F9FA">
                        <StackPanel>
                            <TextBlock Text="Ready to Generate?" 
                                       Style="{StaticResource SectionHeaderStyle}"
                                       Foreground="#28A745"/>
                            
                            <Button Content="🔧 Generate Certificate" 
                                    Command="{Binding GenerateCertificateCommand}"
                                    IsEnabled="{Binding CertificateRequest.CanGenerate}"
                                    Style="{StaticResource PrimaryButtonStyle}"
                                    ToolTip="Generate the certificate with the settings above (Alt+G)"
                                    FontSize="16"
                                    Padding="24,12"
                                    FontWeight="Bold"
                                    HorizontalAlignment="Stretch"
                                    Margin="0,5,0,5"/>
                            
                            <TextBlock FontSize="11" Foreground="#666666" HorizontalAlignment="Center">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="Fill out all required fields (*) above to enable this button"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding CertificateRequest.CanGenerate}" Value="True">
                                                <Setter Property="Text" Value="✓ All required fields complete - click to generate your certificate"/>
                                                <Setter Property="Foreground" Value="#28A745"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Settings panel removed - now opens in dedicated window -->

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="#F8F9FA" BorderBrush="#E9ECEF" BorderThickness="0,1,0,0" Padding="20,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="📋 " FontSize="16" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBlock Text="{Binding StatusMessage}" 
                               VerticalAlignment="Center"
                               FontSize="13"/>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="🔐 Generate Certificate" 
                            Command="{Binding GenerateCertificateCommand}"
                            Style="{StaticResource PrimaryButtonStyle}"
                            IsEnabled="{Binding CertificateRequest.CanGenerate}"
                            Padding="20,10"
                            FontSize="14"
                            FontWeight="SemiBold"
                            ToolTip="Generate the certificate with the settings above (Alt+G)"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
